

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>5.3. Self-consistent field (SCF) methods &mdash; PySCF 1.7.6 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5.4. Density functional theory (DFT)" href="dft_developer.html" />
    <link rel="prev" title="5.2. General designs" href="../design.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">3. Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user.html">4. User guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../develop.html">5. Developer documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../code-rule.html">5.1. Code standard</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design.html">5.2. General designs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.3. Self-consistent field (SCF) methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">5.3.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrals">5.3.2. Integrals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-hamiltonians">5.3.3. Custom Hamiltonians</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dft_developer.html">5.4. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tdscf_developer.html">5.5. Time-dependent SCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="fci_developer.html">5.6. Full CI solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc_developer.html">5.7. Coupled Cluster Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="agf2_developer.html">5.8. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcscf_developer.html">5.9. Multi-configuration SCF</a></li>
<li class="toctree-l2"><a class="reference internal" href="soscf_developer.html">5.10. Second-order SCF solver</a></li>
<li class="toctree-l2"><a class="reference internal" href="ao2mo_developer.html">5.11. AO to MO transformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="df_developer.html">5.12. Density fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="pbc_developer.html">5.13. Periodic boundary conditions</a></li>
<li class="toctree-l2"><a class="reference internal" href="eph_developer.html">5.14. Electron Phonon Coupling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced.html">5.15. Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../develop.html"><span class="section-number">5. </span>Developer documentation</a> &raquo;</li>
        
      <li><span class="section-number">5.3. </span>Self-consistent field (SCF) methods</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/develop/scf_developer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="self-consistent-field-scf-methods">
<span id="developer-scf"></span><h1><span class="section-number">5.3. </span>Self-consistent field (SCF) methods<a class="headerlink" href="#self-consistent-field-scf-methods" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../modules/scf.html#module-scf" title="scf: restricted and unrestricted, closed shell and open shell Hartree-Fock methods"><code class="xref py py-mod docutils literal notranslate"><span class="pre">scf</span></code></a>, <a class="reference internal" href="../modules/pbc/scf.html#module-pbc.scf" title="pbc.scf: Hartree-Fock methods with periodic boundary conditions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.scf</span></code></a>, <a class="reference internal" href="../modules/soscf.html#module-soscf" title="soscf"><code class="xref py py-mod docutils literal notranslate"><span class="pre">soscf</span></code></a></p>
<div class="section" id="overview">
<h2><span class="section-number">5.3.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The class <a class="reference internal" href="../modules/scf.html#pyscf.scf.hf.SCF" title="pyscf.scf.hf.SCF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.hf.SCF</span></code></a> is the base class for all mean-field methods,
which are implemented as derived classes. These include</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 36%" />
<col style="width: 64%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.hf.RHF" title="pyscf.scf.hf.RHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.hf.RHF</span></code></a></p></td>
<td><p>RHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.uhf.UHF" title="pyscf.scf.uhf.UHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.uhf.UHF</span></code></a></p></td>
<td><p>UHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.rohf.ROHF" title="pyscf.scf.rohf.ROHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.rohf.ROHF</span></code></a></p></td>
<td><p>ROHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.ghf.GHF" title="pyscf.scf.ghf.GHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.ghf.GHF</span></code></a></p></td>
<td><p>GHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.dhf.DHF" title="pyscf.scf.dhf.DHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.dhf.DHF</span></code></a></p></td>
<td><p>Dirac-HF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/scf.html#pyscf.scf.dhf.RDHF" title="pyscf.scf.dhf.RDHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.dhf.RDHF</span></code></a></p></td>
<td><p>restricted Dirac-HF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.rks.RKS" title="pyscf.dft.rks.RKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.rks.RKS</span></code></a></p></td>
<td><p>RKS-DFT</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.uks.UKS" title="pyscf.dft.uks.UKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.uks.UKS</span></code></a></p></td>
<td><p>UKS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.roks.ROKS" title="pyscf.dft.roks.ROKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.roks.ROKS</span></code></a></p></td>
<td><p>ROKS-DFT</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.gks.GKS" title="pyscf.dft.gks.GKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.gks.GKS</span></code></a></p></td>
<td><p>GKS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.dks.DKS" title="pyscf.dft.dks.DKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.dks.DKS</span></code></a></p></td>
<td><p>Dirac-KS-DFT</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/dft.html#pyscf.dft.dks.RDKS" title="pyscf.dft.dks.RDKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.dft.dks.RDKS</span></code></a></p></td>
<td><p>restricted Dirac-KS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.hf.SCF" title="pyscf.pbc.scf.hf.SCF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.hf.SCF</span></code></a></p></td>
<td><p>base class for SCF methods with PBC at <span class="math notranslate nohighlight">\(\Gamma\)</span> point</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.hf.RHF" title="pyscf.pbc.scf.hf.RHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.hf.RHF</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point RHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.uhf.UHF" title="pyscf.pbc.scf.uhf.UHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.uhf.UHF</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point UHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.rohf.ROHF" title="pyscf.pbc.scf.rohf.ROHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.rohf.ROHF</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point ROHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.ghf.GHF" title="pyscf.pbc.scf.ghf.GHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.ghf.GHF</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point GHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.rks.RKS" title="pyscf.pbc.dft.rks.RKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.rks.RKS</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point RKS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.uks.UKS" title="pyscf.pbc.dft.uks.UKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.uks.UKS</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point UKS-DFT</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.roks.ROKS" title="pyscf.pbc.dft.roks.ROKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.roks.ROKS</span></code></a></p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point ROKS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.khf.KSCF" title="pyscf.pbc.scf.khf.KSCF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.khf.KSCF</span></code></a></p></td>
<td><p>base class for SCF methods with PBC and with k-point sampling</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.khf.KRHF" title="pyscf.pbc.scf.khf.KRHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.khf.KRHF</span></code></a></p></td>
<td><p>KRHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.kuhf.KUHF" title="pyscf.pbc.scf.kuhf.KUHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.kuhf.KUHF</span></code></a></p></td>
<td><p>KUHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.krohf.KROHF" title="pyscf.pbc.scf.krohf.KROHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.krohf.KROHF</span></code></a></p></td>
<td><p>KROHF</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/scf.html#pyscf.pbc.scf.kghf.KGHF" title="pyscf.pbc.scf.kghf.KGHF"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.scf.kghf.KGHF</span></code></a></p></td>
<td><p>KGHF</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.krks.KRKS" title="pyscf.pbc.dft.krks.KRKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.krks.KRKS</span></code></a></p></td>
<td><p>KRKS-DFT</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.kuks.KUKS" title="pyscf.pbc.dft.kuks.KUKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.kuks.KUKS</span></code></a></p></td>
<td><p>KUKS-DFT</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../modules/pbc/dft.html#pyscf.pbc.dft.kroks.KROKS" title="pyscf.pbc.dft.kroks.KROKS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.pbc.dft.kroks.KROKS</span></code></a></p></td>
<td><p>KROKS-DFT</p></td>
</tr>
</tbody>
</table>
<p>The key attributes of the SCF class include</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 86%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">init_guess</span></code></p></td>
<td><p>initial guess method</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">DIIS</span></code></p></td>
<td><p>DIIS method, can be <a class="reference internal" href="../modules/scf.html#pyscf.scf.diis.DIIS" title="pyscf.scf.diis.DIIS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.diis.DIIS</span></code></a>, <a class="reference internal" href="../modules/scf.html#pyscf.scf.diis.EDIIS" title="pyscf.scf.diis.EDIIS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.diis.EDIIS</span></code></a>, or <a class="reference internal" href="../modules/scf.html#pyscf.scf.diis.ADIIS" title="pyscf.scf.diis.ADIIS"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyscf.scf.diis.ADIIS</span></code></a></p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_coeff</span></code></p></td>
<td><p>saved MO coefficients</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_energy</span></code></p></td>
<td><p>saved MO energies</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-attr docutils literal notranslate"><span class="pre">mo_occ</span></code></p></td>
<td><p>saved MO occupations</p></td>
</tr>
</tbody>
</table>
<p>The SCF iterative loop is the <a class="reference internal" href="../modules/scf.html#pyscf.scf.hf.kernel" title="pyscf.scf.hf.kernel"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.scf.hf.kernel()</span></code></a> function
which takes a mean-field object.
The <code class="xref py py-func docutils literal notranslate"><span class="pre">kernel()</span></code> function carries out the following steps:</p>
<ul class="simple">
<li><p>generating an initial guess – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_init_guess()</span></code></p></li>
<li><p>building the Fock matrix, which consists of</p>
<ul>
<li><p>building the 1-e part – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_hcore()</span></code></p></li>
<li><p>building the 2-e part – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_veff()</span></code> (takes the DM as input, and internally
calls <code class="xref py py-func docutils literal notranslate"><span class="pre">get_jk()</span></code>, which calls <code class="xref py py-func docutils literal notranslate"><span class="pre">get_j()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">get_k()</span></code>)</p></li>
<li><p>assembling the Fock matrix from <span class="math notranslate nohighlight">\(h_{\rm core}\)</span> and <span class="math notranslate nohighlight">\(v_{\rm eff}\)</span> and extrapolating
by DIIS – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_fock()</span></code></p></li>
</ul>
</li>
<li><p>obtaining the 1-e overlap – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_ovlp()</span></code></p></li>
<li><p>computing the new eigenvectors and eigenvalues – <code class="xref py py-func docutils literal notranslate"><span class="pre">eig()</span></code>,
and filling and assembling the new DM – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_occ()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">make_rdm1()</span></code></p></li>
<li><p>testing for convergence – <code class="xref py py-func docutils literal notranslate"><span class="pre">get_grad()</span></code></p></li>
<li><p>updating the energy – <code class="xref py py-func docutils literal notranslate"><span class="pre">energy_tot()</span></code>, which calls <code class="xref py py-func docutils literal notranslate"><span class="pre">energy_elec()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">energy_nuc()</span></code></p></li>
<li><p>optionally writing results to the checkfile – <code class="xref py py-func docutils literal notranslate"><span class="pre">dump_chk()</span></code></p></li>
</ul>
<p>Internally, different methods reuse this kernel by overwriting the
mean-field methods.</p>
<ul class="simple">
<li><p>DFT SCF is implemented by
specializing <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_veff()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">energy_elec()</span></code> for the various KS objects
(see e.g., <a class="reference internal" href="../modules/dft.html#pyscf.dft.rks.get_veff" title="pyscf.dft.rks.get_veff"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.dft.rks.get_veff()</span></code></a> and <a class="reference internal" href="../modules/dft.html#pyscf.dft.rks.energy_elec" title="pyscf.dft.rks.energy_elec"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.dft.rks.energy_elec()</span></code></a>).</p></li>
<li><p>Density Fitting (DF) is applied by overwriting the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_jk()</span></code> method
with the DF three center 2-e integrals. (see e.g., <a class="reference internal" href="../modules/df.html#pyscf.df.df_jk.density_fit" title="pyscf.df.df_jk.density_fit"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.df.df_jk.density_fit()</span></code></a>)</p></li>
<li><p><span class="math notranslate nohighlight">\(\Gamma\)</span>-point PBC SCF re-implements</p>
<ul>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ovlp()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_hcore()</span></code> with crystal orbital 1-e integrals and optionally PBC pseudopotentials</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_jk()</span></code> with PBC DF integrals (e.g., <a class="reference internal" href="../modules/pbc/df.html#pyscf.pbc.df.df_jk.get_jk" title="pyscf.pbc.df.df_jk.get_jk"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.pbc.df.df_jk.get_jk()</span></code></a>)</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">energy_nuc()</span></code> with Ewald summation (<code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.pbc.gto.ewald()</span></code>)</p></li>
</ul>
</li>
<li><p>Based on the <span class="math notranslate nohighlight">\(\Gamma\)</span>-point PBC SCF,
k-point PBC SCF computes <code class="xref py py-meth docutils literal notranslate"><span class="pre">make_rdm1()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ovlp()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_hcore()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_jk()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">eig()</span></code> at each k-point,
and re-implements <code class="xref py py-meth docutils literal notranslate"><span class="pre">energy_elec()</span></code> with a k-point summation.</p></li>
</ul>
</div>
<div class="section" id="integrals">
<h2><span class="section-number">5.3.2. </span>Integrals<a class="headerlink" href="#integrals" title="Permalink to this headline">¶</a></h2>
<p>The molecular HF operator relies on the following underlying AO integral functions:</p>
<ul class="simple">
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_hcore()</span></code> calls 1-e integral functions
<code class="xref py py-meth docutils literal notranslate"><span class="pre">mol.intor('int1e_kin')()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">mol.intor('int1e_nuc')()</span></code> (or <code class="xref py py-meth docutils literal notranslate"><span class="pre">mol.intor('ECPscalar')()</span></code> if using ECP)
to compute the kinetic energy and nuclear attraction matrices.</p></li>
<li><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_jk()</span></code> computes Coulomb and exchange matrices for the input DM.
If enough memory is provided, the two-electron repulsion integral is computed (<code class="xref py py-meth docutils literal notranslate"><span class="pre">mol.intor('int2e')()</span></code>)
and saved as the attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">_eri</span></code>,
and is then contracted with the DM (<a class="reference internal" href="../modules/scf.html#pyscf.scf.hf.dot_eri_dm" title="pyscf.scf.hf.dot_eri_dm"><code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.scf.hf.dot_eri_dm()</span></code></a>) (incore algorithm).
Otherwise, a “direct” algorithm, where the AO integrals are computed on the fly,
is used (<code class="xref py py-func docutils literal notranslate"><span class="pre">pyscf.scf._vhf.direct()</span></code>). The incore path can be forced by
setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">incore_anyway</span></code> of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Mole</span></code> object to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p></li>
</ul>
</div>
<div class="section" id="custom-hamiltonians">
<h2><span class="section-number">5.3.3. </span>Custom Hamiltonians<a class="headerlink" href="#custom-hamiltonians" title="Permalink to this headline">¶</a></h2>
<p>The HF approximation SCF procedure can be used for arbitrary Hamiltonians.
This is useful when considering model Hamiltonians. The key functions to supply
are the initial guess (which can also be generated by supplying an initial DM),
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get_ovlp()</span></code>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_hcore()</span></code>, and the two electron integrals
(attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">_eri</span></code> of the mean-field object).
The following shows an example of HF with a Hubbard model Hamiltonian:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">pyscf</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span><span class="p">,</span> <span class="n">ao2mo</span><span class="p">,</span> <span class="n">mcscf</span>

<span class="n">mol</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">()</span>

<span class="c1"># incore_anyway=True ensures the customized Hamiltonian (the _eri attribute)</span>
<span class="c1"># is used.  Without this parameter, the MO integral transformation used in</span>
<span class="c1"># subsequent post-HF calculations may</span>
<span class="c1"># ignore the customized Hamiltonian if there is not enough memory.</span>
<span class="n">mol</span><span class="o">.</span><span class="n">incore_anyway</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">mol</span><span class="o">.</span><span class="n">nelectron</span> <span class="o">=</span> <span class="n">n</span>

<span class="n">h1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
<span class="n">h1</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>  <span class="c1"># PBC</span>
<span class="n">eri</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">eri</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">RHF</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_hcore</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">h1</span>
<span class="n">mf</span><span class="o">.</span><span class="n">get_ovlp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="c1"># ao2mo.restore(8, eri, n) to get 8-fold permutation symmetry of the integrals</span>
<span class="c1"># ._eri only supports two-electron integrals with 4-fold or 8-fold symmetry.</span>
<span class="n">mf</span><span class="o">.</span><span class="n">_eri</span> <span class="o">=</span> <span class="n">ao2mo</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">eri</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">mf</span><span class="o">.</span><span class="n">init_guess</span> <span class="o">=</span> <span class="s1">&#39;1e&#39;</span>
<span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>

<span class="c1"># post-SCF calculation</span>
<span class="n">mycas</span> <span class="o">=</span> <span class="n">mcscf</span><span class="o">.</span><span class="n">CASSCF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">mycas</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="dft_developer.html" class="btn btn-neutral float-right" title="5.4. Density functional theory (DFT)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../design.html" class="btn btn-neutral float-left" title="5.2. General designs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>