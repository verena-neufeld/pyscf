

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4.17.3. Density fitting for crystalline calculations &mdash; PySCF 1.7.6 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="4.17.4. Mixing PBC and molecular modules" href="mix_mol.html" />
    <link rel="prev" title="4.17.2. SCF and DFT methods" href="scf.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> PySCF
          

          
          </a>

          
            
            
              <div class="version">
                1.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">1. An overview of PySCF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">3. Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../user.html">4. User guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../gto.html">4.1. Molecular structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scf.html">4.2. Self-consistent field (SCF) methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dft.html">4.3. Density functional theory (DFT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mp.html">4.4. Second-Order Møller–Plesset Perturbation Theory (MP2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gw.html">4.5. GW approximation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ci.html">4.6. Configuration interaction (CISD and FCI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cc.html">4.7. Coupled-cluster theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../adc.html">4.8. Algebraic diagrammatic construction (ADC) scheme</a></li>
<li class="toctree-l2"><a class="reference internal" href="../agf2.html">4.9. Auxiliary second-order Green’s function perturbation theory (AGF2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mcscf.html">4.10. Multi-configuration self-consistent field (MCSCF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tddft.html">4.11. Time-dependent Hartree-Fock and Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rt.html">4.12. Real-time time-dependent density functional theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../solvent.html">4.13. Solvation models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qmmm.html">4.14. QM/MM methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x2c.html">4.15. Relativistic calculations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../df.html">4.16. Density fitting</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../pbc.html">4.17. Periodic boundary conditions</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gto.html">4.17.1. Crystal structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="scf.html">4.17.2. SCF and DFT methods</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.17.3. Density fitting for crystalline calculations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">4.17.3.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-df-in-periodic-calculations">4.17.3.2. Using DF in periodic calculations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#controlling-df-error">4.17.3.3. Controlling DF error</a></li>
<li class="toctree-l4"><a class="reference internal" href="#saving-and-reusing-df-integrals">4.17.3.4. Saving and reusing DF integrals</a></li>
<li class="toctree-l4"><a class="reference internal" href="#choice-of-df-methods">4.17.3.5. Choice of DF methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="#references">4.17.3.6. References</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="mix_mol.html">4.17.4. Mixing PBC and molecular modules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../eph.html">4.18. Electron Phonon Matrix</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../develop.html">5. Developer documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">6. API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interface.html">7. Interfaces</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PySCF</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../user.html"><span class="section-number">4. </span>User guide</a> &raquo;</li>
        
          <li><a href="../pbc.html"><span class="section-number">4.17. </span>Periodic boundary conditions</a> &raquo;</li>
        
      <li><span class="section-number">4.17.3. </span>Density fitting for crystalline calculations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/user/pbc/df.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="density-fitting-for-crystalline-calculations">
<span id="user-pbc-df"></span><h1><span class="section-number">4.17.3. </span>Density fitting for crystalline calculations<a class="headerlink" href="#density-fitting-for-crystalline-calculations" title="Permalink to this headline">¶</a></h1>
<p><em>Modules</em>: <a class="reference internal" href="../df.html#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a>, <a class="reference internal" href="../../modules/pbc/df.html#module-pbc.df" title="pbc.df: Density fitting and RI approximation with periodic boundary conditions"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pbc.df</span></code></a></p>
<div class="section" id="introduction">
<h2><span class="section-number">4.17.3.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Like for molecular calculations, density fitting (DF) is useful to reduce the computational cost of manipulating the electron repulsion integrals (ERIs) in periodic calculations. Currently, PySCF provides three periodic DF methods that are different in the auxiliary basis functions being used.</p>
<ul class="simple">
<li><p>The fast Fourier transform density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">FFTDF</span></code>) uses plane waves (PWs) as the auxiliary basis functions. FFTDF is also known as the Gaussian and plane wave (GPW) approach in literature and other software packages. <a class="bibtex reference internal" href="#vandevondele05cpc" id="id1">[6]</a><a class="bibtex reference internal" href="#kuhne20jcp" id="id2">[7]</a></p></li>
<li><p>The Gaussian density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">GDF</span></code>) uses Gaussian-type orbitals (GTOs) as the auxiliary basis functions. <a class="bibtex reference internal" href="#sun17jcp" id="id3">[8]</a></p></li>
<li><p>The mixed density fitting (<code class="xref py py-class docutils literal notranslate"><span class="pre">MDF</span></code>) uses both PWs and GTOs as the auxiliary basis functions. <a class="bibtex reference internal" href="#sun17jcp" id="id4">[8]</a></p></li>
</ul>
<p>This section of the user document covers the basic usage of these DF methods in periodic calculations. The recommended choice of DF methods for different applications is also provided. See <span class="xref std std-ref">theory_df</span> for the use of DF in molecular calculations.</p>
</div>
<div class="section" id="using-df-in-periodic-calculations">
<h2><span class="section-number">4.17.3.2. </span>Using DF in periodic calculations<a class="headerlink" href="#using-df-in-periodic-calculations" title="Permalink to this headline">¶</a></h2>
<p>Unlike for molecular calculations, DF is used by default in periodic SCF calculations. For example, initialize a KRHF object uses FFTDF by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">scf</span>
<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s2">&quot;He 0 0 0&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;6-31g&quot;</span><span class="p">)</span>
<span class="n">kpts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span><span class="p">)</span>  <span class="c1"># &lt;pyscf.pbc.df.fft.FFTDF at 0x7feb78373c88&gt;</span>
</pre></div>
</div>
<p>The periodic SCF class also provides methods for using GDF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
</pre></div>
</div>
<p>and MDF:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">mix_density_fit</span><span class="p">()</span>
</pre></div>
</div>
<p>In addition to using the APIs above, the user can also initialize a DF method first and overwrite the attribute <code class="xref py py-attr docutils literal notranslate"><span class="pre">with_df</span></code> of the SCF object. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">df</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">GDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">with_df</span> <span class="o">=</span> <span class="n">mydf</span>
</pre></div>
</div>
<p>Once the periodic mean-field calculation is done, the subsequent correlated calculations will automatically use the same DF method to handle ERIs. For example, a MP2 calculation using GDF can be performed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="o">...</span> <span class="c1"># initialize cell and kpts</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">scf</span><span class="p">,</span> <span class="n">mp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span> <span class="o">=</span> <span class="n">scf</span><span class="o">.</span><span class="n">KRHF</span><span class="p">(</span><span class="n">mf</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span><span class="o">.</span><span class="n">density_fit</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mf</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>         <span class="c1"># perform HF with GDF</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mmp</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">KMP2</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mmp</span><span class="o">.</span><span class="n">kernel</span><span class="p">()</span>        <span class="c1"># perform MP2 with GDF</span>
</pre></div>
</div>
</div>
<div class="section" id="controlling-df-error">
<h2><span class="section-number">4.17.3.3. </span>Controlling DF error<a class="headerlink" href="#controlling-df-error" title="Permalink to this headline">¶</a></h2>
<p>The DF error is introduced by the incompleteness of the finite auxiliary basis used to expand the atomic orbital pair densities. The DF error can often be reduced by increasing the number of auxiliary basis functions being used.</p>
<div class="section" id="fftdf">
<span id="df-err-fftdf"></span><h3><span class="section-number">4.17.3.3.1. </span>FFTDF<a class="headerlink" href="#fftdf" title="Permalink to this headline">¶</a></h3>
<p>FFTDF uses plane waves (PWs) as the auxiliary basis, whose size is determined by <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFTDF.mesh</span></code>, which is set to <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> upon initialization. <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> is a 1d array-like object of three integer numbers, <code class="docutils literal notranslate"><span class="pre">[nx,</span> <span class="pre">ny,</span> <span class="pre">nz]</span></code>, that defines the number of PWs (or the real-space grid points in the unit cell) for <span class="math notranslate nohighlight">\(x\)</span>, <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(z\)</span> directions, respectively. The total number of PWs being used for FFTDF is hence <code class="docutils literal notranslate"><span class="pre">nx</span> <span class="pre">*</span> <span class="pre">ny</span> <span class="pre">*</span> <span class="pre">nz</span></code>. PySCF determines <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.mesh</span></code> from <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> - the kinetic energy cutoff. By default, <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> is determined by requiring the PW expansion of the most compact atomic orbitals in the basis set to achieve <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.precision</span></code>.</p>
<p>To use a PW basis of size other than the default, the user can either overwrite <code class="xref py py-attr docutils literal notranslate"><span class="pre">FFTDF.mesh</span></code> directly, or change it by changing <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code>. An example is provided as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyscf.pbc</span> <span class="kn">import</span> <span class="n">gto</span><span class="p">,</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">print_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mesh = [</span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">, </span><span class="si">%d</span><span class="s2">]  (</span><span class="si">%d</span><span class="s2"> PWs)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="o">*</span><span class="n">mesh</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">mesh</span><span class="p">)))</span>

<span class="n">cell</span> <span class="o">=</span> <span class="n">gto</span><span class="o">.</span><span class="n">M</span><span class="p">(</span><span class="n">atom</span><span class="o">=</span><span class="s2">&quot;He 0 0 0&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s2">&quot;gth-dzvp&quot;</span><span class="p">,</span> <span class="n">pseudo</span><span class="o">=</span><span class="s2">&quot;gth-pade&quot;</span><span class="p">)</span>
<span class="n">kpts</span> <span class="o">=</span> <span class="n">cell</span><span class="o">.</span><span class="n">make_kpts</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">FFTDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [42, 42, 42]  (74088 PWs)</span>
<span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [17, 17, 17]  (4913 PWs)</span>
<span class="n">cell</span><span class="o">.</span><span class="n">ke_cutoff</span> <span class="o">=</span> <span class="mi">60</span>   <span class="c1"># unit: Rydberg</span>
<span class="n">cell</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>          <span class="c1"># rebuild cell to update cell.mesh</span>
<span class="n">mydf</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">FFTDF</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">kpts</span><span class="p">)</span>
<span class="n">print_mesh</span><span class="p">(</span><span class="n">mydf</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
<span class="c1"># output: mesh = [14, 14, 14]  (2744 PWs)</span>
</pre></div>
</div>
<p>Note that PySCF’s default for <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.precision</span></code> is relatively conservative (<span class="math notranslate nohighlight">\(10^{-8} E_h\)</span>). This often leads to a <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code> higher than the default used by other packages using FFTDF. <a class="bibtex reference internal" href="#kuhne20jcp" id="id5">[7]</a>
For a more cost-effective choice, the user can scan over a series of <code class="xref py py-attr docutils literal notranslate"><span class="pre">mesh</span></code> size (or <code class="xref py py-attr docutils literal notranslate"><span class="pre">ke_cutoff</span></code> values) and monitor the convergence of e.g., the converged SCF energies.</p>
</div>
<div class="section" id="gdf">
<h3><span class="section-number">4.17.3.3.2. </span>GDF<a class="headerlink" href="#gdf" title="Permalink to this headline">¶</a></h3>
<p>GDF uses Gaussian-type orbitals (GTOs) as the auxiliary basis and parallels the <a class="reference internal" href="../df.html#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a> module for molecular calculations. We guide the readers to <a class="reference internal" href="../df.html#choice-of-auxbasis"><span class="std std-ref">Choice of auxiliary basis</span></a> for more details on how to choose the auxiliary basis sets for GDF. A GDF-specific example can be found in <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/pbc/35-gaussian_density_fit.py">examples/pbc/35-gaussian_density_fit.py</a>.</p>
</div>
<div class="section" id="mdf">
<h3><span class="section-number">4.17.3.3.3. </span>MDF<a class="headerlink" href="#mdf" title="Permalink to this headline">¶</a></h3>
<p>MDF uses mixed GTOs and PWs as the fitting basis. The GTO part of the auxiliary basis can be set in the same way as for GDF (again, see <a class="reference internal" href="../df.html#choice-of-auxbasis"><span class="std std-ref">Choice of auxiliary basis</span></a>), while the PW part is similar to FFTDF, i.e., setting either <code class="xref py py-attr docutils literal notranslate"><span class="pre">MDF.mesh</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.ke_cutoff</span></code>. The default size of the PW basis is also relatively conservative, and the user is recommended to conduct a convergence test as mentioned in <a class="reference internal" href="#df-err-fftdf"><span class="std std-ref">FFTDF</span></a>.</p>
</div>
</div>
<div class="section" id="saving-and-reusing-df-integrals">
<h2><span class="section-number">4.17.3.4. </span>Saving and reusing DF integrals<a class="headerlink" href="#saving-and-reusing-df-integrals" title="Permalink to this headline">¶</a></h2>
<p>While FFTDF is implemented in the so-called integral-direct manner and needs no “initialization”, both GDF and MDF pre-compute required integrals and dump them to disk for later use. The APIs for saving and reusing GDF/MDF integrals are the same as in the molecular <a class="reference internal" href="../df.html#module-df" title="df: Density fitting and RI approximation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">df</span></code></a> module; we guide the user to <a class="reference internal" href="../df.html#save-reuse-df-integrals"><span class="std std-ref">Saving and reusing DF integrals</span></a> for a detailed description. An example is provided in <a class="reference external" href="https://github.com/pyscf/pyscf/tree/master/examples/pbc/35-gaussian_density_fit.py">examples/pbc/35-gaussian_density_fit.py</a>.</p>
</div>
<div class="section" id="choice-of-df-methods">
<h2><span class="section-number">4.17.3.5. </span>Choice of DF methods<a class="headerlink" href="#choice-of-df-methods" title="Permalink to this headline">¶</a></h2>
<p>The choice of DF methods depends on the type of applications, the required accuracy, and the available computational resources.</p>
<div class="section" id="type-of-calculations">
<h3><span class="section-number">4.17.3.5.1. </span>Type of calculations<a class="headerlink" href="#type-of-calculations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>For <strong>all-electron</strong> calculations, only GDF and MDF can be used, while FFTDF would require an impractically large PW basis to describe the core orbitals accurately (hydrogen and helium are two exceptions since they don’t have core orbitals).</p></li>
<li><p>For <strong>pseudopotential (PP)</strong>-based calculations, all three DF methods can be used.</p></li>
<li><p>For calculations on <strong>low-dimension</strong> systems (0D, 1D, and 2D), only GDF and MDF can be used. The user needs to specify the dimension by setting <code class="xref py py-attr docutils literal notranslate"><span class="pre">Cell.dimension</span></code>.</p></li>
</ul>
</div>
<div class="section" id="required-accuracy">
<h3><span class="section-number">4.17.3.5.2. </span>Required accuracy<a class="headerlink" href="#required-accuracy" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>FFTDF can be regarded “exact” for PP-based calculations within the given AO basis if a sufficiently large PW basis is used.</p></li>
<li><p>GDF has a typical error of <span class="math notranslate nohighlight">\(10^{-5} \sim 10^{-4} E_h\)</span> when using PySCF’s default auxiliary basis. <a class="bibtex reference internal" href="#sun17jcp" id="id6">[8]</a><a class="bibtex reference internal" href="#ye20arxiv" id="id7">[9]</a> This error can be reduced by using a larger auxiliary basis set. <a class="bibtex reference internal" href="#ye20arxiv" id="id8">[9]</a></p></li>
<li><p>MDF is in general more accurate than GDF and comparable to FFTDF if a sufficiently large PW basis is used. The typical error of MDF is <span class="math notranslate nohighlight">\(10^{-6} E_h\)</span> or lower with the default parameters. <a class="bibtex reference internal" href="#sun17jcp" id="id9">[8]</a></p></li>
</ul>
</div>
<div class="section" id="computational-resources">
<h3><span class="section-number">4.17.3.5.3. </span>Computational resources<a class="headerlink" href="#computational-resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>GDF requires <strong>enough disk space</strong> to hold the pre-computed DF integrals. The size of these integrals grows quickly with the system size and scales as <span class="math notranslate nohighlight">\(O(N_k^2 n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span>, where <span class="math notranslate nohighlight">\(N_k\)</span> is the number of k-points, <span class="math notranslate nohighlight">\(n_{\mathrm{AO}}\)</span> is the number of AOs per unit cell, and <span class="math notranslate nohighlight">\(n_{\mathrm{aux}}\)</span> is the number of auxiliary basis functions per unit cell. Note that for DFT calculations using pure exchange-correlation functionals (LDA and GGA), the storage requirement reduces to <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span>, which is much more modest.</p></li>
<li><p>FFTDF uses very little disk space but requires <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 N_{\mathrm{PW}})\)</span> <strong>memory</strong>, where <span class="math notranslate nohighlight">\(N_{\mathrm{PW}}\)</span> is the size of the PW basis. Despite the modest, linear dependence on <span class="math notranslate nohighlight">\(N_k\)</span>, the memory requirement could be high for systems that require a relatively large PW basis.</p></li>
<li><p>MDF requires both a <span class="math notranslate nohighlight">\(O(N_k^2 n_{\mathrm{AO}}^2 n_{\mathrm{aux}})\)</span> disk space to store pre-computed integrals of the GTO part of the auxiliary basis and a <span class="math notranslate nohighlight">\(O(N_k n_{\mathrm{AO}}^2 N_{\mathrm{PW}})\)</span> memory for the PW part. However, both <span class="math notranslate nohighlight">\(n_{\mathrm{aux}}\)</span> and <span class="math notranslate nohighlight">\(N_{\mathrm{PW}}\)</span> here are smaller than that required by GDF and FFTDF, respectively.</p></li>
</ul>
</div>
</div>
<div class="section" id="references">
<h2><span class="section-number">4.17.3.6. </span>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p id="bibtex-bibliography-user/pbc/df-0"><dl class="citation">
<dt class="bibtex label" id="dunlap00pccp"><span class="brackets">1</span></dt>
<dd><p>Brett I. Dunlap. Robust and variational fitting. <em>Phys. Chem. Chem. Phys.</em>, 2:2113–2116, 2000. <a class="reference external" href="https://doi.org/10.1039/B000027M">doi:10.1039/B000027M</a>.</p>
</dd>
<dt class="bibtex label" id="hellweg07tca"><span class="brackets">2</span></dt>
<dd><p>Arnim Hellweg, Christof Hättig, Sebastian Höfener, and Wim Klopper. Optimized accurate auxiliary basis sets for ri-mp2 and ri-cc2 calculations for the atoms rb to rn. <em>Theor. Chem. Acc.</em>, 117:587–597, 2007. <a class="reference external" href="https://doi.org/10.1007/s00214-007-0250-5">doi:10.1007/s00214-007-0250-5</a>.</p>
</dd>
<dt class="bibtex label" id="weigend98cpl"><span class="brackets">3</span></dt>
<dd><p>Florian Weigend, Marco Häser, Holger Patzelt, and Reinhart Ahlrichs. Ri-mp2: optimized auxiliary basis sets and demonstration of efficiency. <em>Chem. Phys. Lett.</em>, 294:143–152, 1998. <a class="reference external" href="https://doi.org/10.1016/S0009-2614(98)00862-8">doi:10.1016/S0009-2614(98)00862-8</a>.</p>
</dd>
<dt class="bibtex label" id="weigend02pccp"><span class="brackets">4</span></dt>
<dd><p>Florian Weigend. A fully direct ri-hf algorithm: implementation, optimised auxiliary basis sets, demonstration of accuracy and efficiency. <em>Phys. Chem. Chem. Phys.</em>, 4:4285–4291, 2002. <a class="reference external" href="https://doi.org/10.1039/B204199P">doi:10.1039/B204199P</a>.</p>
</dd>
<dt class="bibtex label" id="weigend06pccp"><span class="brackets">5</span></dt>
<dd><p>Florian Weigend. Accurate coulomb-fitting basis sets for h to rn. <em>Phys. Chem. Chem. Phys.</em>, 8:1057–1065, 2006. <a class="reference external" href="https://doi.org/10.1039/B515623H">doi:10.1039/B515623H</a>.</p>
</dd>
<dt class="bibtex label" id="vandevondele05cpc"><span class="brackets"><a class="fn-backref" href="#id1">6</a></span></dt>
<dd><p>Joost VandeVondele, Matthias Krack, Fawzi Mohamed, Michele Parrinello, Thomas Chassaing, and Jürg Hutter. Quickstep: fast and accurate density functional calculations using a mixed gaussian and plane waves approach. <em>Comput. Phys. Commun.</em>, 167(2):103 – 128, 2005. <a class="reference external" href="https://doi.org/10.1016/j.cpc.2004.12.014">doi:10.1016/j.cpc.2004.12.014</a>.</p>
</dd>
<dt class="bibtex label" id="kuhne20jcp"><span class="brackets">7</span><span class="fn-backref">(<a href="#id2">1</a>,<a href="#id5">2</a>)</span></dt>
<dd><p>Thomas D. Kühne, Marcella Iannuzzi, Mauro Del Ben, Vladimir V. Rybkin, Patrick Seewald, Frederick Stein, Teodoro Laino, Rustam Z. Khaliullin, Ole Schütt, Florian Schiffmann, Dorothea Golze, Jan Wilhelm, Sergey Chulkov, Mohammad Hossein Bani-Hashemian, Valéry Weber, Urban Borštnik, Mathieu Taillefumier, Alice Shoshana Jakobovits, Alfio Lazzaro, Hans Pabst, Tiziano Müller, Robert Schade, Manuel Guidon, Samuel Andermatt, Nico Holmberg, Gregory K. Schenter, Anna Hehn, Augustin Bussy, Fabian Belleflamme, Gloria Tabacchi, Andreas Glöβ, Michael Lass, Iain Bethune, Christopher J. Mundy, Christian Plessl, Matt Watkins, Joost VandeVondele, Matthias Krack, and Jürg Hutter. Cp2k: an electronic structure and molecular dynamics software package - quickstep: efficient and accurate electronic structure calculations. <em>J. Chem. Phys.</em>, 152(19):194103, 2020. <a class="reference external" href="https://doi.org/10.1063/5.0007045">doi:10.1063/5.0007045</a>.</p>
</dd>
<dt class="bibtex label" id="sun17jcp"><span class="brackets">8</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>,<a href="#id6">3</a>,<a href="#id9">4</a>)</span></dt>
<dd><p>Qiming Sun, Timothy C. Berkelbach, James D. McClain, and Garnet Kin-Lic Chan. Gaussian and plane-wave mixed density fitting for periodic systems. <em>J. Chem. Phys.</em>, 147(16):164119, 2017. <a class="reference external" href="https://doi.org/10.1063/1.4998644">doi:10.1063/1.4998644</a>.</p>
</dd>
<dt class="bibtex label" id="ye20arxiv"><span class="brackets">9</span><span class="fn-backref">(<a href="#id7">1</a>,<a href="#id8">2</a>)</span></dt>
<dd><p>Hong-Zhou Ye and Timothy C. Berkelbach. Fast periodic gaussian density fitting by range separation. <em>arXiv preprint arXiv:2102.02989</em>, 2021.</p>
</dd>
</dl>
</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mix_mol.html" class="btn btn-neutral float-right" title="4.17.4. Mixing PBC and molecular modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="scf.html" class="btn btn-neutral float-left" title="4.17.2. SCF and DFT methods" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2015-2021, The PySCF Developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>